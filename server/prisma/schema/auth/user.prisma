// User model for local authentication

model User {
  id            String    @id @default(uuid())
  email         String    @unique
  passwordHash  String    @map("password_hash")

  // Profile information
  firstName     String?   @map("first_name")
  lastName      String?   @map("last_name")
  avatarUrl     String?   @map("avatar_url")
  bio           String?
  language      String?   @default("en")

  // Account status
  isActive      Boolean   @default(true) @map("is_active")
  isEmailVerified Boolean @default(false) @map("is_email_verified")
  emailVerifiedAt DateTime? @map("email_verified_at")

  // Authentication tracking
  lastLoginAt   DateTime? @map("last_login_at")
  lastLoginIp   String?   @map("last_login_ip")
  loginCount    Int       @default(0) @map("login_count")
  passwordChangedAt DateTime? @map("password_changed_at")

  // Soft delete
  deletedAt     DateTime? @map("deleted_at")
  isDeleted     Boolean   @default(false) @map("is_deleted")

  // Timestamps
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")

  // Relations
  sessions      Session[]
  refreshTokens RefreshToken[]
  passwordResets PasswordReset[]
  assetPermissions UserAssetPermission[]

  // Organization relations
  ownedOrganizations Organization[]       @relation("OwnedOrganizations")
  organizationMemberships OrganizationMember[]
  invitedOrgMembers OrganizationMember[]     @relation("InvitedMembers")
  // grantedPermissions OrganizationPermission[] @relation("GrantedPermissions") // DEFERRED: Deep permissions for later

  // Site relations
  ownedSites    Site[]           @relation("OwnedSites")
  siteUsers     SiteUser[]
  sentInvitations    SiteInvitation[] @relation("SentInvitations")
  acceptedInvitations SiteInvitation[] @relation("AcceptedInvitations")
  events        Event[]
  clients       Client[]
  waitingListEntries WaitingListEntry[] @relation("WaitingListCreator")

  @@index([email])
  @@index([isDeleted])
  @@map("users")
}